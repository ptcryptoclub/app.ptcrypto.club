{% extends "layout.html" %}


{% block info_line %}
{% endblock %}


{% block content %}
<div class="container mt-4">

    <div class="row row-cols-1 row-cols-sm-2 row-cols-lg-3 row-cols-xl-3 mb-2">
        {% for card in cards %}
            <div class="col-xl-4 col-lg-4 col-sm-6 mb-2">
                <a href="#" class="text-decoration-none">
                    {% if card["change"] < 0 %}
                    {% set color = "danger" %}
                    {% elif card["change"] == 0 %}
                    {% set color = "warning" %}
                    {% else %}
                    {% set color = "success" %}
                    {% endif %}
                    <div class="p-2 border border-{{color}} rounded-lg" id="general-{{card['market']}}-{{card['base']}}-{{card['quote']}}">
                        <div class="row">
                            <div class="col">
                                <h4 class="text-light" id="card-{{card['market']}}-{{card['base']}}-{{card['quote']}}">{{card['base'].upper()+card['quote'].upper()}}</h4>
                            </div>
                            <div class="col-auto text-right">
                                <small class="font-italic text-muted" id="market-{{card['market']}}-{{card['base']}}-{{card['quote']}}">{{card["market"]}}</small>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-auto">
                                <h5 class="text-{{color}} ml-3" id="change-{{card['market']}}-{{card['base']}}-{{card['quote']}}">{{card["change"]}}%</h5>
                            </div>
                            <div class="col">
                                <h4 class="text-right text-{{color}}" id="last-{{card['market']}}-{{card['base']}}-{{card['quote']}}">{{card["last_price"] | numberFormat}}</h4>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col" style="height: 0px;" id="smallChart-{{card['market']}}-{{card['base']}}-{{card['quote']}}"></div>
                            <script>

                            </script>
                        </div>
                        <div class="row">
                            <div class="col-auto">
                                <div class="row-fluid text-muted text-center"><small>Last 24h</small></div>
                                <div class="row-fluid text-muted small" id="high-{{card['market']}}-{{card['base']}}-{{card['quote']}}"><strong>High: </strong>{{card["high"] | numberFormat}}</div>
                                <div class="row-fluid text-muted small" id="low-{{card['market']}}-{{card['base']}}-{{card['quote']}}"><strong>Low: </strong>{{card["low"] | numberFormat}}</div>
                            </div>
                            <div class="col">
                                <div class="row justify-content-end mr-2 text-muted"><strong>Volume:</strong></div>
                                <div class="row justify-content-end mr-2 text-muted small" id="volume-{{card['market']}}-{{card['base']}}-{{card['quote']}}">{{card["volume"] | numberFormat}} {{card['base'].upper()}}</div>
                                <div class="row justify-content-end mr-2 text-muted small" id="volumeQuote-{{card['market']}}-{{card['base']}}-{{card['quote']}}">{{card["volume_quote"] | numberFormat}} {{card['quote'].upper()}}</div>
                            </div>
                        </div>
                    </div>
                </a>
            </div>
        <script>
                let general{{card['market']}}{{card['base']}}{{card['quote']}} = document.getElementById("general-{{card['market']}}-{{card['base']}}-{{card['quote']}}");
                let market{{card['market']}}{{card['base']}}{{card['quote']}} = document.getElementById("market-{{card['market']}}-{{card['base']}}-{{card['quote']}}");
                let change{{card['market']}}{{card['base']}}{{card['quote']}} = document.getElementById("change-{{card['market']}}-{{card['base']}}-{{card['quote']}}");
                let last{{card['market']}}{{card['base']}}{{card['quote']}} = document.getElementById("last-{{card['market']}}-{{card['base']}}-{{card['quote']}}");
                let high{{card['market']}}{{card['base']}}{{card['quote']}} = document.getElementById("high-{{card['market']}}-{{card['base']}}-{{card['quote']}}");
                let low{{card['market']}}{{card['base']}}{{card['quote']}} = document.getElementById("low-{{card['market']}}-{{card['base']}}-{{card['quote']}}");
                let volume{{card['market']}}{{card['base']}}{{card['quote']}} = document.getElementById("volume-{{card['market']}}-{{card['base']}}-{{card['quote']}}");
                let volumeQuote{{card['market']}}{{card['base']}}{{card['quote']}} = document.getElementById("volumeQuote-{{card['market']}}-{{card['base']}}-{{card['quote']}}");
                function func{{card['market']}}{{card['base']}}{{card['quote']}} () {
                    fetch('/api/home/cards/{{card['base']}}/{{card['quote']}}/{{card['market']}}/{{card['delta']}}/').then(
                        function(response){
                            response.json().then(
                                function (data) {
                                    change{{card['market']}}{{card['base']}}{{card['quote']}}.innerHTML = data['change'] + '%';
                                    if (data['change'] < 0) {
                                        general{{card['market']}}{{card['base']}}{{card['quote']}}.className = 'p-2 border border-danger rounded-lg'
                                        change{{card['market']}}{{card['base']}}{{card['quote']}}.className = 'text-danger ml-3'
                                        last{{card['market']}}{{card['base']}}{{card['quote']}}.className = 'text-right text-danger'
                                    } else if (data['change'] === 0) {
                                        general{{card['market']}}{{card['base']}}{{card['quote']}}.className = 'p-2 border border-warning rounded-lg'
                                        change{{card['market']}}{{card['base']}}{{card['quote']}}.className = 'text-warning ml-3'
                                        last{{card['market']}}{{card['base']}}{{card['quote']}}.className = 'text-right text-warning'
                                    } else {
                                        general{{card['market']}}{{card['base']}}{{card['quote']}}.className = 'p-2 border border-success rounded-lg'
                                        change{{card['market']}}{{card['base']}}{{card['quote']}}.className = 'text-success ml-3'
                                        last{{card['market']}}{{card['base']}}{{card['quote']}}.className = 'text-right text-success'
                                    }
                                    last{{card['market']}}{{card['base']}}{{card['quote']}}.innerHTML = numberFormat(data['last_price']);
                                    high{{card['market']}}{{card['base']}}{{card['quote']}}.innerHTML = '<strong>High: </strong>' + numberFormat(data['high']);
                                    low{{card['market']}}{{card['base']}}{{card['quote']}}.innerHTML = '<strong>Low: </strong>' + numberFormat(data['low']);
                                    volume{{card['market']}}{{card['base']}}{{card['quote']}}.innerHTML = numberFormat(data['volume']);
                                    volumeQuote{{card['market']}}{{card['base']}}{{card['quote']}}.innerHTML = numberFormat(data['volume_quote']);
                                }
                            )
                        }
                    );
                };
                var run{{card['market']}}{{card['base']}}{{card['quote']}}=setInterval(func{{card['market']}}{{card['base']}}{{card['quote']}},2000);
            </script>
        {% endfor %}
    </div>
</div>
{% endblock %}
        